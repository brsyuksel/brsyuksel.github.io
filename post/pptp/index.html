<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      pptpd ile pptp vpn server kurulumu &middot; barış yüksel
    
  </title>

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>barış yüksel</p>
    <p><em>python, go, c, linux</em></p>
    <p><a href="https://twitter.com/brsyuksel">twitter</a> &middot; <a href="https://github.com/brsyuksel">github</a> &middot; <a href="https://www.linkedin.com/pub/bar%C4%B1%C5%9F-y%C3%BCksel/54/178/273">linkedin</a></p>

  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">home</a>
    <a class="sidebar-nav-item " href="/post">posts</a>

    
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    

  </nav>

  <div class="sidebar-item">
    <p>&copy; barış yüksel 2014.</p>
  </div>
</div>


    
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">barış yüksel</a>
            <small>in code we trust</small>
          </h3>
        </div>
      </div>

      <div class="container content">


<div class="post">
  <h1 class="post-title">pptpd ile pptp vpn server kurulumu</h1>
  <span class="post-date">1 jan, 2014</span>
  

<p>dns çözümlerinin yetersiz kaldığı anlarda(!) vpn çözümlerine başvuruyoruz. bu dökümanda düşük bir maliyetle edinebileceğiniz vps&rsquo;inizi nasıl size özel bir pptp vpn-server&rsquo;a çevirebileceğinizi anlatmaya çalışacağım. ücretsiz vpn hizmetlerinin yetersiz kaldığı anlarda(!) hızlı bir çözüm olacaktır. server kurulumu fedora 19, client fedora 20 olsa da bir çok dağıtım için yapılandırma benzer olacaktır.</p>

<p>başlamadan bahsedeyim alternatif olarak openVPN gibi çözümler mevcut ancak kaynak kullanımı, hız-performans gibi konulardan ötürü ben pptp&rsquo;yi tercih ettim. yine de farklı yetenekli olan openVPN&rsquo;i deneyebilirsiniz.</p>

<h1 id="toc_0">server</h1>

<p>pptpd paketini kurun.</p>

<pre><code class="language-bash">yum install pptpd
</code></pre>

<p>ilk olarak pptpd ayarlarında bir kaç değişiklik yapmanız gerekiyor. <code>/etc/pptpd.conf</code> dosyasında şu düzenlemeleri yapın.</p>

<p>#logwtmp
  localip 10.0.0.1
  remoteip 10.0.0.100-200</p>

<p>logwtmp satırını disable ederek connection loglarının tutulmasını kapatmış bulunuyoruz. daha fazla yapılandırma bilgisi için <code>man pptpd.conf</code> yazarak bilgi alabilirsiniz.</p>

<p><code>/etc/ppp/options.pptpd</code> dosyasında yine bir kaç satırlık düzenleme yapmanız gerekiyor. client&rsquo;ların dns hizmeti için hangi sağlayıcının kullanılacabını belirleyin. ben alttaki örnekte google dns(!) kullandım.</p>

<p>ms-dns 8.8.8.8
  ms-dns 8.8.4.4</p>

<p><code>/etc/ppp/chap-secrets</code> dosyasında uygun formatta vpn-server&rsquo;ınızın kullanıcınılarını basit bir şekilde kullanıcı adı ve şifre olarak tanımlıyorsunuz.</p>

<p>[USERNAME] pptpd [PASSWORD] *</p>

<p><em>[USERNAME]</em> ve <em>[PASSWORD]</em> alanlarını kendinize göre düzenleyin. eklemek istediğiniz kullanıcı varsa aynı dosyaya aynı formatta eklemeye devam edebilirsiniz.</p>

<p>şimdi ip forwarding&rsquo;i açmamız gerekiyor. geçici olarak açmak istediğiniz taktirde şu komutu kullanabilirsiniz:</p>

<pre><code class="language-bash">sysctl net.ipv4.ip_forward=1
</code></pre>

<p>ancak olası bir reboot sonrası bu ayar default değer olan 0 değerini alacağından kalıcı olması için <code>/etc/sysctl.d/99-ip_forward.conf</code> dosyasını oluşturup aynı komutu dosyaya girdi olarak bırakıyoruz</p>

<p>net.ipv4.ip_forward=1</p>

<p>ayarların uygulanması için tekrar sysctl&rsquo;den yararlanıyoruz. aşağıdaki komut yardımcı olacaktır.</p>

<pre><code class="language-bash">sysctl --system
</code></pre>

<p>bu noktadan sonra iptables&rsquo;a bazı eklemeleri yapmamız gerekiyor. bunlar şu şekilde:</p>

<pre><code class="language-bash">iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
iptables --table nat --append POSTROUTING --out-interface ppp0 -j MASQUERADE
iptables -I INPUT -s 10.0.0.0/8 -i ppp0 -j ACCEPT
iptables --append FORWARD --in-interface eth0 -j ACCEPT
</code></pre>

<p>iptables girdileri yine reboot sonrası kalıcı olmayacağından girdileri <code>/etc/iptables/iptables.rules</code> dosyasına kaydetmek kalıcılık sağlayacaktır. aşağıdaki komut aradığınız çözüm.</p>

<pre><code class="language-bash">iptables-save &gt; /etc/iptables/iptables.rules
</code></pre>

<p>server yapılandırmasında sona geldik. şimdi iptables servisini yeniden başlatıp ve pptpd servisini başlatıp reboot sonrası otomatik başlatma için ayarlayın.</p>

<pre><code class="language-bash">systemctl restart iptables.service
systemctl start pptpd.service
systemctl enable pptpd.service
</code></pre>

<h1 id="toc_1">client</h1>

<p>bu adımda client&rsquo;ımızı yapılandırıp vpn-server&rsquo;ımıza bağlanacağız.</p>

<p>client&rsquo;da pptp paketine ihtiyaç duyuyoruz. pptp paketini yükleyin.</p>

<pre><code class="language-bash">yum install pptp
</code></pre>

<p>bağlanacağımız vpn-server&rsquo;ları <code>/etc/ppp/peers/</code> klasörü altında belirli bir formatta tanımlıyoruz. bu noktada kullanacağınız vpn-server&rsquo;ı tanımladığınız dosya adı önemli çünkü ilerde bağlantı sağlanırken kullanılan komutta bu dosya adını parametre olarak vereceğiz.</p>

<p><code>/etc/ppp/peers/ozelvpn</code> dosyası şu şekilde olabilir.</p>

<p>pty &ldquo;pptp [SERVERIP] &ndash;nolaunchpppd&rdquo;
  name [USERNAME]
  password [PASSWORD]
  remotename PPTP
  require-mppe-128</p>

<p>örnekteki <em>[SERVERIP]</em> yerine VPS&rsquo;inizin IP adresini yazmalısınız. <em>[USERNAME]</em> ve <em>[PASSWORD]</em> alanlarına server&rsquo;da <code>/etc/ppp/chap-secrets</code> dosyasında tanımladığınız uygun kullanıcının bilgilerini girmeniz gerekiyor.</p>

<p>şimdi vpn-serverımızla bağlantıyı sağlayalım.</p>

<pre><code class="language-bash">pppd call ozelvpn
</code></pre>

<p>bu komutu çalıştırdıktan sonra <strong>ozelvpn</strong> olarak tanımladığınız vpn&rsquo;inize bağlanmış olacaksınız ancak tunnelling hala gerçekleşmiyor. vpn ile olan bağlantınızı kontrol etmek için aşağıdaki komutu kullanabilirsiniz.</p>

<pre><code class="language-bash">tail -f /var/log/messages
</code></pre>

<p>tunnelling&rsquo;i gerçekleştirmek için bir route işlemine ihtiyaç duyuyor olacaksınız. bu işlemi de şu şekilde gerçekleştirip son adımı tamamlamış olacaksınız ve artık packet&rsquo;ler vpn üzerinden dolaşacak. ip adres kontrolü sağlayan sitelerden ip adresinizi <a href="http://ipadresimnedir.org" title="ipadresimnedir.org">ipadresimnedir.org</a> sitesinden ya da hiç vakit kaybetmeden özgürlüğünüzü, 21.yy dünyasında demoktratik haklarınızın engellenip engellenmediğini(!) kontrol edebilirsiniz.</p>

<pre><code class="language-bash">route add default dev ppp0
</code></pre>

<p>route işlemi de kalıcı değildir. pppd call işleminden sonra otomatik olarak yapılmasını istiyorsanız <code>/etc/ppp/ip-up.local</code> dosyasını oluşturup şu girdiyi bırakın:</p>

<p>#!/bin/bash
  route add default dev ppp0</p>

<p>daha sonra dosyayı executable yapın.</p>

<pre><code class="language-bash">chmod +x /etc/ppp/ip-up.local
</code></pre>

<p>bu işlemden sonra her <code>pppd call ozelvpn</code> komutundan sonra route işlemi gerçekleştirilmiş olacak.</p>

</div>

      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-49309607-1', 'auto');
    ga('send', 'pageview');

  </script>
  </body>
</html>

