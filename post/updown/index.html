<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      slackware pppd ve updown scripti &middot; barış yüksel
    
  </title>

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>barış yüksel</p>
    <p><em>python, go, c, linux</em></p>
    <p><a href="https://twitter.com/brsyuksel">twitter</a> &middot; <a href="https://github.com/brsyuksel">github</a> &middot; <a href="https://www.linkedin.com/pub/bar%C4%B1%C5%9F-y%C3%BCksel/54/178/273">linkedin</a></p>

  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">home</a>
    <a class="sidebar-nav-item " href="/post">posts</a>

    
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    

  </nav>

  <div class="sidebar-item">
    <p>&copy; barış yüksel 2014.</p>
  </div>
</div>


    
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">barış yüksel</a>
            <small>in code we trust</small>
          </h3>
        </div>
      </div>

      <div class="container content">


<div class="post">
  <h1 class="post-title">slackware pppd ve updown scripti</h1>
  <span class="post-date">1 jan, 2014</span>
  <p>slackware&rsquo;da pptp-client uygulamasını yükledikten sonra, uygulamanın fedora&rsquo;daki gibi route tablosunu tunnelling&rsquo;i sağlayacak şekilde düzenlemediğini fark ettim. açıkcası bu sorun sürüm farklılığından mı, script/conf eksikliğinden mi ya da başka bir sebepten mi kaynaklanıyor araştırmadım, pppd&rsquo;nin script&rsquo;lerini kullanarak çözüme gitmek yeterince vakit kazandırdı.</p>

<p>pptp sağlayıcısı ile bağlantı sağlandıktan sonra, default route girişini her seferinde elle girmek yerine <strong>/etc/ppp</strong> klasörü altında executable bir <strong>ip-up</strong> scripti oluşturup otomatik olarak çalışmasını sağlayabiliyorsunuz. slackware altında nedense <strong>host target route</strong> girişi otomatik olarak yapılmıyor, bu script ile bu sorunu aşabilirsiniz. ancak <strong>birden çok</strong> sağlayıcı kullanıyorsanız, bu script&rsquo;in farklı sağlayıcılar için otomatik olarak çalıştırılması anlamsız bir hale geliyor. sağlayıcının kendi ip adresini <strong>host target</strong> olarak route tablosuna eklemezseniz, başarısız bir sonuç alırsınız.</p>

<p>bu soruna çözüm olması için <strong>updown</strong> adını verdiğim basit bir script oluşturdum. pppd&rsquo;nin bir özelliği olan ipparam&rsquo;dan yararlandım. peer dosyasında tanımladığınız <strong>ipparam</strong> değeri, bağlantı durumlarında <strong>ip-up</strong> ve <strong>ip-down</strong> script&rsquo;lerine <strong>parametre</strong> olarak iletiliyor. updown, bu parametreye uygun olarak düzenlenmiş script&rsquo;i çalıştırarak bağlantı sonrası yapılması gereken rutinleri, kolay yönetilebilir hale getiriyor.</p>

<p>vpnbook serverlarını için peer dosyaları oluşturup updown&rsquo;ın kullanımını özetleyeyim.</p>

<p>öncelikle updown script&rsquo;ini <strong>/etc/ppp</strong> klasörü altına indirin:</p>

<pre><code class="language-bash">cd /etc/ppp; wget https://raw.githubusercontent.com/brsyuksel/pppd-updown/master/updown &amp;&amp; chmod +x updown
</code></pre>

<p><strong>/etc/ppp</strong> altında <strong>ip-up</strong> ve <strong>ip-down</strong> scriptleriniz varsa, yedekledikten sonra silin.</p>

<pre><code class="language-bash">/etc/ppp/updown link
</code></pre>

<p>komutunu vererek, updown&rsquo;ın ip-up ve ip-down adında <strong>kendisine linklenmiş symbolic linkler</strong> oluşturmasını sağlayın.</p>

<p>vpnbook us serveri için <code>/etc/ppp/peers</code> klasörü altında vpnbookus dosyasını oluşturun ve şu şekilde düzenleyin:</p>

<p>pty &ldquo;pptp us1.vpnbook.com &ndash;nolaunchpppd&rdquo;
  name vpnbook
  password GUNCELVPNBOOKSIFRESI
  remotename PPTP
  require-mppe-128
  lock
  nobsdcomp
  nodeflate
  ipparam vpnbookus</p>

<p>bu noktada <strong>ipparam vpnbookus</strong> önemli. updown ile bu parametre için basit bir script oluşturup rutinlerin yönetilmesini sağlayacağız.</p>

<p>updown ile vpnbookus parametresi için manager script&rsquo;i oluşturalım. bu komutla template script&rsquo;i oluşturabilirsiniz:</p>

<pre><code class="language-bash">/etc/ppp/updown template vpnbookus
</code></pre>

<p>bu komutu verdikten sonra updown.vpnbookus adında basit bir script editörünüzde açılacak ve düzenlemeniz istenecek. bağlantı sağlandığı zaman bu script içerisinden start fonksiyonu, bağlantı kapandığında ise stop fonksiyonu çalıştırılıyor. durumlara göre route işlemlerini ve rutinleri yapmalısınız. vpnbook us server&rsquo;ı için şu şekilde düzenleyin ( <strong>device interface, gateway gibi parametreleri kendinize göre düzenlemeyi unutmayın</strong> ) :</p>

<pre><code class="language-bash">start(){
# us1.vpnbook.com ip addr: 198.7.62.204

# tunnelling icin gerekli route tablosu.
/sbin/route add -host 198.7.62.204 gw 192.168.1.1 dev wlan0
/sbin/route add default dev ppp0
/sbin/route del default dev wlan0

# nameserver gibi rutinler vs.
cat &lt;&lt; EOF &gt; /etc/resolv.conf
nameserver 8.8.8.8
nameserver 8.8.4.4
EOF

}

stop(){
/sbin/route del -host 198.7.62.204 dev wlan0
/sbin/route add default gw 192.168.1.1 dev wlan0
}
</code></pre>

<p>ve artık bağlantınızı sağlayabilirsiniz: <code>pppd call vpnbookus</code></p>

<p>bu noktadan sonra yine örnek olarak vpnbook eu serverları için aynı yolu izleyerek configuration&rsquo;ları tamamlayıp ve geçerli bağlantıyı kapattıktan sonra diğer bir server&rsquo;a bağlantıyı <code>pppd call PEERDOSYASIADI</code> komutuyla kolayca sağlayabilirsiniz.</p>

<p>updown gibi basit bir script için fazlasıyla uzunca bir döküman oldu sanırım :)</p>

</div>

      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-49309607-1', 'auto');
    ga('send', 'pageview');

  </script>
  </body>
</html>

