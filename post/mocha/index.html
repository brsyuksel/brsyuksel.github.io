<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      mocha - js/cs test framework &middot; barış yüksel
    
  </title>

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>barış yüksel</p>
    <p><em>python, go, c, linux</em></p>
    <p><a href="https://twitter.com/brsyuksel">twitter</a> &middot; <a href="https://github.com/brsyuksel">github</a> &middot; <a href="https://www.linkedin.com/pub/bar%C4%B1%C5%9F-y%C3%BCksel/54/178/273">linkedin</a></p>

  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">home</a>
    <a class="sidebar-nav-item " href="/post">posts</a>

    
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    

  </nav>

  <div class="sidebar-item">
    <p>&copy; barış yüksel 2014.</p>
  </div>
</div>


    
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">barış yüksel</a>
            <small>in code we trust</small>
          </h3>
        </div>
      </div>

      <div class="container content">


<div class="post">
  <h1 class="post-title">mocha - js/cs test framework</h1>
  <span class="post-date">1 jan, 2014</span>
  

<p><a href="http://visionmedia.github.io/mocha/">mocha</a>, node.js ve aynı zamanda browser&rsquo;larda çalışabilen bir javascript test framework&rsquo;ü. bir çok test interface&rsquo;i, assertion library&rsquo;si desteği, çalışma zamanı seçenekleri ile gerçekten yeterince olgun ve kolaylık sağlayan bir framework. ayrıca coffeescript desteği mevcut olması benim için tercih sebeplerinden bir tanesi oldu.</p>

<p>ben bu yazıda mocha&rsquo;yı node.js üzerinde bdd interface&rsquo;i ve node.js&rsquo;in default assert kütüphanesi ile nasıl kullanabileceğinizden bahsedeceğim. uygulama geliştirirken test yazmanız için yeterli olacaktır ancak <a href="http://visionmedia.github.io/mocha/#interfaces">diğer interface</a>&lsquo;ler ve <a href="http://visionmedia.github.io/mocha/#assertions">assertion kütüphanelerini</a> kullanmak dilerseniz onlar da gayet kolay.</p>

<h1 id="toc_0">node.js assert kütüphanesi</h1>

<p>mocha&rsquo;yı kullanmadan önce node.js&rsquo;in assert kütüphanesini tanımak önemli. assert kütüphanesinde detaylandırılacak pek bir nokta yok bu nedenle kütüphaneyi method&rsquo;larıyla ve küçük örneklerle hızlıca tanıtacağım.</p>

<p>assert kütüphanesi method&rsquo;ları, parametre olarak verilen değer(ler) için karşılaştırma yapar. belirli durumlar için karşılaştırma method&rsquo;ları mevcut olup şartın sağlanmaması durumunda <strong>AssertionError</strong> throw ederler.</p>

<pre><code class="language-javascript">assert.ok(value, [message]); // assert(value, [message])
</code></pre>

<p>bu method bir değerin undefined/null olup olmadığını test eder. yani yapılan işlem şudur: <code>!!value == true</code></p>

<pre><code class="language-javascript">assert.ifError(value)
</code></pre>

<p>bu method ise <strong>assert.ok</strong>&lsquo;un olumsuzu olarak kullanılabilir. false değerler için sağlanırken, true değerler için exception throw edilir.</p>

<pre><code class="language-javascript">assert.equal(a, b, [message])
</code></pre>

<p>bu method ile a ve b değerlerinin eşitliği karşılaştırılır, &ldquo;a == b&rdquo;. olumsuzu için, yani &ldquo;a != b&rdquo; için <code>assert.notEqual</code> benzer şekilde kullanılır.</p>

<pre><code class="language-javascript">assert.deepEqual(a, b, [message])
</code></pre>

<p>verilen değerlere çeşitli karşılaştırma yapar. object olmayanlar için &ldquo;==&rdquo; karşılaştırması, date objectler için getTime karşılaştırması, objectler içinse size, key, lenght gibi çeşitli karşılaştırmalar yapar. olumsuz koşul için <code>assert.notDeepEqual</code> kullanılır.</p>

<pre><code class="language-javascript">assert.strictEqual(a, b, [message])
</code></pre>

<p>değerler arasında strict karşılaştırma yapar, &ldquo;a === b&rdquo;. olumsuzu için <code>assert.notStrictEqual</code> kullanılır.</p>

<pre><code class="language-javascript">assert.throws(block, [error], [message])
</code></pre>

<p>bu method ile verilen block&rsquo;un error throw etme durumu kontrol edilir. error parametresi ile regexp bir value olarak verildiğinde exception mesajı ile eşleşmesi kontrol edilirken, function olarak da verilip kullanıcı tanımlı işlem gerçekleştirilebilir. yine exception throw etmeyen durumlar için <code>assert.doesNotThrow(block, [message])</code> kullanılabilir.</p>

<h1 id="toc_1">mocha</h1>

<p>mocha&rsquo;nın npm ile kurulumunu şu şekilde: <code>npm install -g mocha</code></p>

<p>mocha ile test yazmaya başlamadan önce yapmanız gereken, <strong>proje dizini altında test adında bir klasör oluşturmak ve test kodlarını içeren dosyaları bu klasör altında bulundurmak.</strong> mocha, çalıştırıldığı zaman bu klasörü arıyor ve burdaki test kodlarını içeren dosyaları yürütüyor.</p>

<p>bdd interface&rsquo;i ile senaryo üzerine test kodu yazılır. mocha&rsquo;nın bdd interface&rsquo;i için api&rsquo;lerinden ilk karşılaşacağımız <strong>describe</strong>. bu method ile test case&rsquo;lerinizi barındıran bir <em>suite</em> oluşturuyorsunuz. gerektiği taktirde nested olarak da kullanabiliyorsunuz. daha sonra da bu suite altında <strong>it</strong> method&rsquo;unu kullanarak senaryonuza yönelik testlerinizi yazıyorsunuz.</p>

<p>genel kullanıma bir örnek:</p>

<pre><code class="language-coffeescript">describe &quot;tests&quot;, -&gt;
  it &quot;should return 0 when the value is not present&quot;, -&gt;
    # ...
  it &quot;should return positive when the value is negative&quot;, -&gt;
    # ...
  describe &quot;nested tests&quot;, -&gt;
    it &quot;should ...&quot;, -&gt;
      # ...
</code></pre>

<p>bu örnek ile <strong>sync</strong> çalışan kodlarınız için test-case&rsquo;ler yazmanız mümkün. <strong>async</strong> için ise, test-case&rsquo;i tanımlarken <strong>it</strong> fonksiyonunda tanımladığımız callback fonksiyonu, <strong>bir</strong> parametre alacak şekilde tanımlıyoruz. mocha, bu durumda fonksiyonu <strong>bir callback parametresi</strong> ile çağırıyor ve test-case&rsquo;in sonuçlanması için kendisi tarafından verilen bu <strong>callback&rsquo;in çağrılmasını</strong> bekliyor. eğer bu callback bir parametre ile çağrılmıyorsa sonuç başarılı, bir error parametresi ile çağrılıyorsa sonuç başarısız kabul ediliyor. async fonksiyonlarınızda callback parametresi ya da promise kullanarak bu callback&rsquo;in çağrılmasını sağlayabilirsiniz.</p>

<pre><code class="language-coffeescript">f = (x) -&gt; unless x then 0 else x

describe &quot;sync test&quot;, -&gt;
  it &quot;should return 0 when the value is not present&quot;, -&gt;
    assert.equal f(), 0

describe &quot;async test&quot;, -&gt;
  it &quot;should do nothing when the file is exists&quot;, (done) -&gt;
    fs = require 'fs'
    fs.exists '/etc/passwd', (e) -&gt;
      unless e then done new Error else done()
</code></pre>

<p>bdd interface&rsquo;inde test-case&rsquo;lerin yürütülme öncesi ve sonrası için belirli rutinleri gerçekleştirebilmeniz adına hook&rsquo;lar mevcut. <strong>before</strong> hook&rsquo;u ile herhangi bir test-case yürütülmeden önce, <strong>after</strong> ile suite altındaki tüm test-case&rsquo;ler bittikten sonra çalıştırılacak callback&rsquo;ler tanımlayabilirsiniz. benzer şekilde <strong>beforeEach</strong> ile suite altındaki her test-case yürütülmeden önce ve <strong>afterEach</strong> ile de suite altındaki her test-case yürütüldükten sonra çağrılacak callback&rsquo;ler tanımlayabilirsiniz. <em>diğer interface&rsquo;ler için de belirli hook&rsquo;lar var ve bunlar da yine bdd hook&rsquo;ları gibi gayet kolay.</em></p>

<pre><code class="language-coffeescript">describe &quot;before-after&quot;, -&gt;
  before -&gt; console.log &quot;hic test yurutulmedi...&quot;
  after -&gt; console.log &quot;butun testler bitti...&quot;
  beforeEach -&gt; console.log &quot;bir test yurutulecek...&quot;
  afterEach -&gt; console.log &quot;bir test bitti...&quot;
  # ...
</code></pre>

<p>bundan sonrası suite&rsquo;ler ve test-case&rsquo;ler için kullanışlı methodlar.</p>

<p>bir çok test arasında kaybolmaya başladığınızda <code>describle.only</code> ve <code>it.only</code> kullanarak <strong>sadece bir suite ya da test-case</strong>&lsquo;in çalışmasını sağlayabilirsiniz. test sonuçları çıktısında sadece ilgili testlerin sonuçlarını göreceksiniz.</p>

<p><code>describe.skip</code> ve <code>it.skip</code> ile ilgili <strong>suite/test-case&rsquo;in çalışmasını engelleyebilirsiniz</strong>. bu durumda ilgili test, pending olarak sonuçlanacaktır.</p>

<p>bir test-case&rsquo;i <strong>pending</strong> olarak tanımlamak istiyorsanız, it fonksiyonuna callback tanımlamayarak sağlayabilirsiniz.</p>

<p>ve testleri çalıştırma işlemi. javascript ile yazdığınız testleri sonuçlandırmak istiyorsanız:</p>

<pre><code class="language-bash">mocha
</code></pre>

<p>coffeescript için ise bir parametreye ihtiyaç duyuyoruz:</p>

<pre><code class="language-bash">mocha --compilers coffee:coffee-script/register
</code></pre>

<p>test dosyalarınızdaki değişikliğin mocha tarafından takip edilerek değişiklik sonrası otomatik olarak çalıştırılması için:</p>

<pre><code class="language-bash">mocha --watch
</code></pre>

<p>son olarak her seferinde bu parametreleri tekrar tekrar yazmak istemiyorsanız, <strong>test</strong> klasörü altında <strong>mocha.opts</strong> adında bir dosya oluşturun ve şu şekilde düzenleyin:</p>

<p>&ndash;compilers coffee:coffee-script/register
  -R spec
  &ndash;watch</p>

<p>bu dosyayı düzenledikten sonra sadece <code>mocha</code> komutunu vermek yeterli olacak.</p>

<p><a href="http://visionmedia.github.io/mocha/">mocha</a>&lsquo;nın sitesinden diğer interface&rsquo;lere, reporter&rsquo;lara, browser support&rsquo;a ve diğer yeteneklerine bakmayı ihmal etmeyin.</p>

</div>

      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-49309607-1', 'auto');
    ga('send', 'pageview');

  </script>
  </body>
</html>

